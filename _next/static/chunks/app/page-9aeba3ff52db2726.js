(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3170:(e,s,t)=>{Promise.resolve().then(t.bind(t,9886))},9886:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var c=t(5155),l=t(2115);function n(e){let{status:s,messages:t,localIP:l,serverIPs:n,connectionError:r}=e;return(0,c.jsxs)("div",{className:"p-4 bg-gray-100 rounded-lg",children:[(0,c.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"网络状态"}),l&&(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{className:"mb-2 text-green-600",children:"您的局域网IP："}),(0,c.jsx)("div",{className:"font-mono bg-gray-200 p-2 rounded",children:l})]}),n.length>0&&(0,c.jsxs)("div",{className:"mt-4",children:[(0,c.jsx)("p",{className:"text-blue-600 mb-2",children:"可用服务IP列表："}),(0,c.jsx)("ul",{className:"list-disc pl-6",children:n.map((e,s)=>(0,c.jsx)("li",{className:"font-mono",children:e},s))})]}),(0,c.jsxs)("div",{className:"mt-6",children:[(0,c.jsx)("p",{className:"text-blue-600 mb-2",children:"WebSocket连接状态："}),"connected"===s&&(0,c.jsx)("div",{className:"text-green-600",children:"✅ 已连接"}),r&&(0,c.jsxs)("div",{className:"text-red-600",children:["❌ ",r]}),"connecting"===s&&(0,c.jsx)("div",{className:"text-yellow-600",children:"正在尝试连接..."})]}),(0,c.jsxs)("div",{className:"mt-6",children:[(0,c.jsx)("h3",{className:"text-sm mb-2",children:"最近接收的消息（最多5条）"}),(0,c.jsx)("ul",{children:t.slice(-5).map((e,s)=>(0,c.jsx)("li",{className:"mb-1 break-all",children:e},s))})]})]})}let r=async()=>{try{let e=await fetch("/api/discover").then(e=>e.json()).then(e=>e.ips);if(e.length>0)return e;let s=await fetch("http://localhost:37520/discover"),{ips:t}=await s.json();return t||[]}catch(e){return console.error("发现服务失败:",e),[]}};var a=t(9509);function o(){let[e,s]=(0,l.useState)(null),[t,o]=(0,l.useState)([]),[i,d]=(0,l.useState)("disconnected"),[m,u]=(0,l.useState)([]),[h]=(0,l.useState)(null),[x,b]=(0,l.useState)([]),p=(0,l.useRef)(null),j=a.env.NEXT_PUBLIC_SERVER_IP||"127.0.0.1",v=(e,s)=>{o(t=>[...t,{type:e,message:s,timestamp:new Date}])};(0,l.useEffect)(()=>{(async()=>{try{let e=new WebSocket("ws://".concat(j,":37521")),t=setTimeout(()=>e.close(),3e3);e.onopen=()=>{clearTimeout(t),s(j),v("success","检测到本机访问，自动使用服务端IP")},e.onerror=()=>{clearTimeout(t),v("error","自动检测失败，请手动输入服务IP"),s(null)},e.onclose=()=>{clearTimeout(t),v("error","自动检测失败，请手动输入服务IP"),s(null)}}catch(s){let e=s instanceof Error?s.message:String(s)||"未知错误";v("error","服务发现失败: ".concat(e))}})()},[j]);let N=(0,l.useMemo)(()=>"ws://".concat(e||j,":37521"),[e,j]);return(0,l.useEffect)(()=>{if(!e)return;let t=null,c=async()=>{p.current&&p.current.close();let e=new WebSocket(N);p.current=e,e.onopen=()=>{clearTimeout(t),d("connected"),v("success","WebSocket已连接到 ".concat(N))},e.onerror=e=>{let t=e.message||"未知错误";v("error","WebSocket连接错误: ".concat(t)),s(null)},e.onclose=e=>{1e3!==e.code?(v("error","连接意外中断: ".concat(e.reason)),s(null)):(v("info","WebSocket连接已关闭"),d("disconnected"))},e.onmessage=e=>{u(s=>[...s,e.data]),v("info","收到服务端消息: ".concat(e.data))}};return c(),t=setTimeout(()=>{p.current||c()},5e3),()=>{var e;null===(e=p.current)||void 0===e||e.close(),t&&clearTimeout(t)}},[e,N]),(0,l.useEffect)(()=>{(async()=>{try{let e=await r();b(e)}catch(e){v("error","服务发现失败: ".concat(e))}})()},[]),(0,c.jsxs)("div",{className:"container mx-auto p-4",children:[(0,c.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"网络测试工具"}),!e&&(0,c.jsxs)("div",{className:"mb-6",children:[(0,c.jsx)("div",{className:"text-red-500 mb-2",children:"无法自动检测到服务IP，请手动输入："}),(0,c.jsx)("label",{htmlFor:"ipInput",className:"block mb-2",children:"服务IP地址："}),(0,c.jsx)("input",{type:"text",id:"ipInput",value:e||"",onChange:e=>s(e.target.value),className:"p-2 border rounded w-full",placeholder:j})]}),(0,c.jsx)(n,{status:i,messages:m,localIP:h,serverIPs:x,connectionError:null,discoveryStatus:"completed",discoveredServices:x.length}),(0,c.jsxs)("div",{className:"bg-gray-100 p-4 rounded",children:[(0,c.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"日志"}),(0,c.jsx)("div",{className:"space-y-2",children:t.map((e,s)=>(0,c.jsxs)("div",{className:"p-2 rounded ".concat("error"===e.type?"bg-red-100":"success"===e.type?"bg-green-100":"bg-blue-100"),children:["[",e.timestamp.toLocaleTimeString(),"] ",e.message]},s))})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[441,684,358],()=>s(3170)),_N_E=e.O()}]);