(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3170:(e,s,c)=>{Promise.resolve().then(c.bind(c,9886))},9886:(e,s,c)=>{"use strict";c.r(s),c.d(s,{default:()=>i});var l=c(5155),t=c(2115);function n(e){let{status:s,messages:c,localIP:t,serverIPs:n,connectionError:a}=e;return(0,l.jsxs)("div",{className:"p-4 bg-gray-100 rounded-lg",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"网络状态"}),t&&(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"mb-2 text-green-600",children:"您的局域网IP："}),(0,l.jsx)("div",{className:"font-mono bg-gray-200 p-2 rounded",children:t})]}),n.length>0&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("p",{className:"text-blue-600 mb-2",children:"可用服务IP列表："}),(0,l.jsx)("ul",{className:"list-disc pl-6",children:n.map((e,s)=>(0,l.jsx)("li",{className:"font-mono",children:e},s))})]}),(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsx)("p",{className:"text-blue-600 mb-2",children:"WebSocket连接状态："}),"connected"===s&&(0,l.jsx)("div",{className:"text-green-600",children:"✅ 已连接"}),a&&(0,l.jsxs)("div",{className:"text-red-600",children:["❌ ",a]}),"connecting"===s&&(0,l.jsx)("div",{className:"text-yellow-600",children:"正在尝试连接..."})]}),(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsx)("h3",{className:"text-sm mb-2",children:"最近接收的消息（最多5条）"}),(0,l.jsx)("ul",{children:c.slice(-5).map((e,s)=>(0,l.jsx)("li",{className:"mb-1 break-all",children:e},s))})]})]})}var a=c(9509);let r=async()=>[a.env.NEXT_PUBLIC_SERVER_IP||"127.0.0.1"];var o=c(9509);function i(){let[e,s]=(0,t.useState)(null),[c,a]=(0,t.useState)([]),[i,d]=(0,t.useState)("disconnected"),[m,u]=(0,t.useState)([]),[x]=(0,t.useState)(null),[h,b]=(0,t.useState)([]),p=(0,t.useRef)(null),N=o.env.NEXT_PUBLIC_SERVER_IP||"127.0.0.1",v=(e,s)=>{a(c=>[...c,{type:e,message:s,timestamp:new Date}])};(0,t.useEffect)(()=>{(async()=>{try{let e=new WebSocket("ws://".concat(N,":37521")),c=setTimeout(()=>e.close(),3e3);e.onopen=()=>{clearTimeout(c),s(N),v("success","检测到本机访问，自动使用服务端IP")},e.onerror=()=>{clearTimeout(c),v("error","自动检测失败，请手动输入服务IP"),s(null)},e.onclose=()=>{clearTimeout(c),v("error","自动检测失败，请手动输入服务IP"),s(null)}}catch(s){let e=s instanceof Error?s.message:null!=s?String(s):"未知错误";v("error","服务发现失败: ".concat(e))}})()},[N]);let j=(0,t.useMemo)(()=>"ws://".concat(e||N,":37521"),[e,N]);return(0,t.useEffect)(()=>{if(e)return(async()=>{p.current&&(p.current.close(),p.current=null);let e=new WebSocket(j);p.current=e,e.onopen=()=>{clearTimeout(null),d("connected"),v("success","WebSocket已连接到 ".concat(j))},e.onerror=e=>{let c=e.message||"未知错误";v("error","WebSocket连接错误: ".concat(c)),s(null)},e.onclose=e=>{1e3!==e.code?(v("error","连接意外中断: ".concat(e.reason)),s(null)):(v("info","WebSocket连接已关闭"),d("disconnected"))},e.onmessage=e=>{u(s=>[...s,e.data]),v("info","收到服务端消息: ".concat(e.data))}})(),()=>{var e;null===(e=p.current)||void 0===e||e.close()}},[e,j]),(0,t.useEffect)(()=>{(async()=>{try{let e=await r();b(e)}catch(e){v("error","服务发现失败: ".concat(e))}})()},[]),(0,l.jsxs)("div",{className:"container mx-auto p-4",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"网络测试工具"}),!e&&(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("div",{className:"text-red-500 mb-2",children:"无法自动检测到服务IP，请手动输入："}),(0,l.jsx)("label",{htmlFor:"ipInput",className:"block mb-2",children:"服务IP地址："}),(0,l.jsx)("input",{type:"text",id:"ipInput",value:e||"",onChange:e=>s(e.target.value),className:"p-2 border rounded w-full",placeholder:N})]}),(0,l.jsx)(n,{status:i,messages:m,localIP:x,serverIPs:h,connectionError:null,discoveryStatus:"completed",discoveredServices:h.length}),(0,l.jsxs)("div",{className:"bg-gray-100 p-4 rounded",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"日志"}),(0,l.jsx)("div",{className:"space-y-2",children:c.map((e,s)=>(0,l.jsxs)("div",{className:"p-2 rounded ".concat("error"===e.type?"bg-red-100":"success"===e.type?"bg-green-100":"bg-blue-100"),children:["[",e.timestamp.toLocaleTimeString(),"] ",e.message]},s))})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[441,684,358],()=>s(3170)),_N_E=e.O()}]);