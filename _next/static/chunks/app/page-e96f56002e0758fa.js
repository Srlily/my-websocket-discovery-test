(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3170:(e,s,t)=>{Promise.resolve().then(t.bind(t,9886))},9886:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var c=t(5155),a=t(2115);function n(e){let{status:s,messages:t,localIP:a,serverIPs:n,matchingIPs:l,connectionError:r}=e;return(0,c.jsxs)("div",{className:"p-4 bg-gray-100 rounded-lg",children:[(0,c.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"网络状态"}),a&&(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{className:"mb-2 text-green-600",children:"您的局域网IP："}),(0,c.jsx)("div",{className:"font-mono bg-gray-200 p-2 rounded",children:a})]}),n.length>0&&(0,c.jsxs)("div",{className:"mt-4",children:[(0,c.jsx)("p",{className:"text-blue-600 mb-2",children:"服务器IP列表："}),(0,c.jsx)("ul",{className:"list-disc pl-6",children:n.map((e,s)=>(0,c.jsxs)("li",{className:"font-mono",children:[e,l.includes(e)&&"✅ 同一网段"]},s))})]}),l.length>0&&(0,c.jsxs)("div",{className:"mt-6",children:[(0,c.jsx)("p",{className:"text-green-600 font-bold mb-2",children:"可连接的服务器IP："}),(0,c.jsx)("ul",{className:"list-disc pl-6",children:l.map((e,s)=>(0,c.jsx)("li",{className:"font-mono bg-green-100 p-1 rounded",children:e},s))})]}),(0,c.jsxs)("div",{className:"mt-6",children:[(0,c.jsx)("p",{className:"text-blue-600 mb-2",children:"WebSocket连接状态："}),"connected"===s&&(0,c.jsxs)("div",{className:"text-green-600",children:["✅ 已连接到 ",l[0]]}),r&&(0,c.jsxs)("div",{className:"text-red-600",children:["❌ ",r]}),"connected"!==s&&!r&&(0,c.jsx)("div",{className:"text-yellow-600",children:"正在尝试连接..."})]}),(0,c.jsxs)("div",{className:"mt-6",children:[(0,c.jsx)("h3",{className:"text-sm mb-2",children:"最近接收的消息（最多5条）"}),(0,c.jsx)("ul",{children:t.slice(-5).map((e,s)=>(0,c.jsx)("li",{className:"mb-1 break-all",children:e},s))})]})]})}let l=async()=>{try{let e=await fetch("/api/local-ip");return(await e.json()).ip}catch(e){return console.error("获取本地IP失败:",e),null}};function r(){let[e,s]=(0,a.useState)(null),[t,r]=(0,a.useState)([]),[i,o]=(0,a.useState)(!1),[d,m]=(0,a.useState)("disconnected"),[u,h]=(0,a.useState)([]),[b,p]=(0,a.useState)(null),[x,f]=(0,a.useState)([]),[j,N]=(0,a.useState)([]),[g,v]=(0,a.useState)(null),S=(0,a.useRef)(null);(0,a.useEffect)(()=>{(async()=>{let t=await l();t&&!e&&(s(t),p(t))})()},[e]),(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/discover"),s=(await e.json()).ips||[];f(s)}catch(e){r(s=>[...s,{type:"error",message:"获取服务器IP失败: ".concat(e instanceof Error?e.message:"未知错误"),timestamp:new Date}])}})()},[]),(0,a.useEffect)(()=>{b&&x.length>0&&N(x.filter(e=>P(e,b)))},[b,x]),(0,a.useEffect)(()=>{if(!e)return;let s=new WebSocket("ws://".concat(e,":37521"));return S.current=s,s.onopen=()=>{m("connected"),y("success","WebSocket已连接")},s.onerror=e=>{let s=e.message||"未知WebSocket错误";m("disconnected"),v(s),y("error","WebSocket连接错误: ".concat(s))},s.onclose=()=>{m("disconnected"),v("连接已关闭"),y("info","WebSocket连接已关闭")},s.onmessage=e=>{h(s=>[...s,e.data]),y("info","收到服务端消息: ".concat(e.data))},()=>{s.readyState===WebSocket.OPEN&&s.close()}},[e]);let y=(e,s)=>{r(t=>[...t,{type:e,message:s,timestamp:new Date}])},P=(e,s)=>{let t=e.split("."),c=s.split(".");return t[0]===c[0]&&t[1]===c[1]&&t[2]===c[2]},k=async()=>{if(!e){y("error","未发现服务，无法进行HTTP测试");return}o(!0),y("info","开始HTTP测试...目标IP: ".concat(e));try{let a=new AbortController,n=setTimeout(()=>a.abort(),5e3),l=await fetch("http://".concat(e,":37520/backend/ip"),{signal:a.signal});if(clearTimeout(n),l.ok){var t,c;let a=await l.json(),n=(null===(t=a.ips)||void 0===t?void 0:t.join(", "))||"无可用IP";y("success","HTTP测试成功！可用IP地址: ".concat(n)),(null===(c=a.ips)||void 0===c?void 0:c.length)&&a.ips[0]!==e&&(s(a.ips[0]),y("info","自动设置服务地址为: ".concat(a.ips[0])))}else y("error","HTTP测试失败，状态码: ".concat(l.status))}catch(e){y("error","HTTP测试异常: ".concat(e instanceof Error?e.message:"未知错误"))}finally{o(!1)}};return(0,c.jsxs)("div",{className:"container mx-auto p-4",children:[(0,c.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"网络测试工具"}),(0,c.jsxs)("div",{className:"mb-6",children:[(0,c.jsx)("label",{htmlFor:"ipInput",className:"block mb-2",children:"服务IP地址："}),(0,c.jsx)("input",{type:"text",id:"ipInput",value:e||"",onChange:e=>s(e.target.value),className:"p-2 border rounded w-full",placeholder:"手动输入IP地址"})]}),(0,c.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,c.jsx)("button",{onClick:()=>{let e=S.current;if(!e||e.readyState!==WebSocket.OPEN){y("error","WebSocket未连接，无法发送测试消息");return}let s=JSON.stringify({text:"测试通知",type:"success",promise:""});e.send(s),y("success","WebSocket测试消息已发送")},disabled:i||"connected"!==d,className:"btn btn-secondary",children:"发送WebSocket测试消息"}),(0,c.jsx)("button",{onClick:k,disabled:!e||i,className:"btn btn-accent",children:"测试HTTP"})]}),(0,c.jsx)(n,{status:d,messages:u,localIP:b,serverIPs:x,matchingIPs:j,connectionError:g}),(0,c.jsxs)("div",{className:"bg-gray-100 p-4 rounded",children:[(0,c.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"日志"}),(0,c.jsx)("div",{className:"space-y-2",children:t.map((e,s)=>(0,c.jsxs)("div",{className:"p-2 rounded ".concat("error"===e.type?"bg-red-100":"success"===e.type?"bg-green-100":"bg-blue-100"),children:["[",e.timestamp.toLocaleTimeString(),"] ",e.message]},s))})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[441,684,358],()=>s(3170)),_N_E=e.O()}]);